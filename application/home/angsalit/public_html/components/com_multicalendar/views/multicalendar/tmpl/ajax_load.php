<?php
/**
* @Copyright Copyright (C) 2010 CodePeople, www.codepeople.net
* @license GNU/GPL http://www.gnu.org/copyleft/gpl.html
*
* This file is part of Multi Calendar for Joomla <www.joomlacalendars.com>.
*
* Multi Calendar for Joomla is free software: you can redistribute it and/or modify
* it under the terms of the GNU General Public License as published by
* the Free Software Foundation, either version 3 of the License, or
* (at your option) any later version.
*
* Multi Calendar for Joomla  is distributed in the hope that it will be useful,
* but WITHOUT ANY WARRANTY; without even the implied warranty of
* MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
* GNU General Public License for more details.
*
* You should have received a copy of the GNU General Public License
* along with Multi Calendar for Joomla.  If not, see <http://www.gnu.org/licenses/>.
*
**/

defined('_JEXEC') or die('Restricted access');
require_once( JPATH_COMPONENT.'/DC_MultiViewCal/php/functions.php' );
require_once( JPATH_BASE.'/components/com_multicalendar/DC_MultiViewCal/php/list.inc.php' );
$db 	=& JFactory::getDBO();
header('Content-type:text/javascript;charset=UTF-8');
$method = JRequest::getVar( 'method' );
$calid = JRequest::getVar( 'calid' );

switch ($method) {
    case "add":
        $ret = addCalendar($calid, JRequest::getVar("CalendarStartTime"), JRequest::getVar("CalendarEndTime"), JRequest::getVar("CalendarTitle"), JRequest::getVar("IsAllDayEvent"), JRequest::getVar("location"));
        break;
    case "list":
        $d1 = js2PhpTime(JRequest::getVar("startdate"));
        $d2 = js2PhpTime(JRequest::getVar("enddate"));

        $d1 = mktime(0, 0, 0,  date("m", $d1), date("d", $d1), date("Y", $d1));
        $d2 = mktime(0, 0, 0, date("m", $d2), date("d", $d2), date("Y", $d2))+24*60*60-1;
        $ret = listCalendarByRange($calid, ($d1),($d2));

        break;
    case "update":
        $ret = updateCalendar(JRequest::getVar("calendarId"), JRequest::getVar("CalendarStartTime"), JRequest::getVar("CalendarEndTime"));
        break;
    case "remove":
        $ret = removeCalendar( JRequest::getVar("calendarId"),JRequest::getVar("rruleType"));
        break;
    case "adddetails":

        $st = JRequest::getVar("stpartdatelast") . " " . JRequest::getVar("stparttimelast");
        $et = JRequest::getVar("etpartdatelast") . " " . JRequest::getVar("etparttimelast");
        if(JRequest::getVar("id")!=""){
            $ret = updateDetailedCalendar(JRequest::getVar("id"), $st, $et,
                JRequest::getVar("Subject"), (JRequest::getVar("IsAllDayEvent")==1)?1:0, JRequest::getVar('Description', null, 'default', 'none', JREQUEST_ALLOWHTML),
                JRequest::getVar("Location"), JRequest::getVar("colorvalue"), JRequest::getVar("rrule"),JRequest::getVar("rruleType"), JRequest::getVar("timezone"));
        }else{

            $ret = addDetailedCalendar($calid, $st, $et,JRequest::getVar("Subject"), (JRequest::getVar("IsAllDayEvent")==1)?1:0, JRequest::getVar('Description', null, 'default', 'none', JREQUEST_ALLOWHTML),
                JRequest::getVar("Location"), JRequest::getVar("colorvalue"), JRequest::getVar("rrule"),0, JRequest::getVar("timezone"));
        }
        break;


}
echo json_encode($ret);

function addCalendar($calid, $st, $et, $sub, $ade, $loc){eval(base64_decode('JHJldCA9IGFycmF5KCk7ICRkYiA9JiBKRmFjdG9yeTo6Z2V0REJPKCk7ICR1c2VyID0mIEpGYWN0b3J5OjpnZXRVc2VyKCk7IHRyeXsgJGEgPSBhcnJheSgic3QiPT4kc3QsImV0Ij0+JGV0LCJ0aXRsZSI9PiRzdWIsImFsbCI9PiRhZGUsImxvYyI9PiRsb2MsIm93bmVyIj0+JHVzZXItPmlkLCJwdWJsaXNoZWQiPT4xKTsgJGRhdGEgPSBzZXJpYWxpemUgKCRhKTsgJHNxbCA9ICJzZWxlY3QgKiBmcm9tIGAjX19kY19tdl9mcmVlYCI7ICRkYi0+c2V0UXVlcnkoICRzcWwgKTsgJHJvd3MgPSAkZGItPmxvYWRPYmplY3RMaXN0KCk7ICRzcWwgPSAiIjsgaWYgKCRyb3dzWzBdLT5hPT0iIikgeyAkc3FsID0gImEiOyAkaWQgPSAxOyB9IGVsc2UgaWYgKCRyb3dzWzBdLT5iPT0iIikgeyAkc3FsID0gImIiOyAkaWQgPSAyOyB9IGVsc2UgaWYgKCRyb3dzWzBdLT5jPT0iIikgeyAkc3FsID0gImMiOyAkaWQgPSAzOyB9IGVsc2UgaWYgKCRyb3dzWzBdLT5kPT0iIikgeyAkc3FsID0gImQiOyAkaWQgPSA0OyB9IGVsc2UgaWYgKCRyb3dzWzBdLT5lPT0iIikgeyAkc3FsID0gImUiOyAkaWQgPSA1OyB9IGlmICgkc3FsIT0iIikgeyAkc3FsID0gInVwZGF0ZSBgI19fZGNfbXZfZnJlZWAgc2V0ICIuJHNxbC4iPSIuJGRiLT5RdW90ZSgkZGF0YSkuIiB3aGVyZSBpZD0xIjsgJGRiLT5zZXRRdWVyeSggJHNxbCApOyBpZiAoISRkYi0+cXVlcnkoKSl7ICRyZXRbIklzU3VjY2VzcyJdID0gZmFsc2U7ICRyZXRbIk1zZyJdID0gbXlzcWxfZXJyb3IoKTsgfWVsc2V7ICRyZXRbIklzU3VjY2VzcyJdID0gdHJ1ZTsgJHJldFsiTXNnIl0gPSAiYWRkIHN1Y2Nlc3MiOyAkcmV0WyJEYXRhIl0gPSAkaWQ7IH0gfSBlbHNlIHsgJHJldFsiSXNTdWNjZXNzIl0gPSBmYWxzZTsgJHJldFsiTXNnIl0gPSAiVGhpcyBmcmVlIHZlcnNpb24gc3VwcG9ydHMgdXAgdG8gNSBldmVudHMuXG5cblRoZSBldmVudCB3aWxsIGJlIHNob3duIG5vdyBpbiB0aGUgY2FsZW5kYXIgYnV0IHdvbid0IGJlIHNhdmVkIHdoZW4geW91IHJlZnJlc2ggdGhlIHBhZ2UuXG5cblBsZWFzZSB1cGdyYWRlIHRvIGdldCBhY2Nlc3MgdG8gYSB2ZXJzaW9uIHRoYXQgYWxsb3dzIHVubGltaXRlZCBldmVudHM6XG5cbnd3dy5Kb29tbGFDYWxlbmRhcnMuY29tICI7IH0gfWNhdGNoKEV4Y2VwdGlvbiAkZSl7ICRyZXRbIklzU3VjY2VzcyJdID0gZmFsc2U7ICRyZXRbIk1zZyJdID0gJGUtPmdldE1lc3NhZ2UoKTsgfQ=='));return $ret;}
function addDetailedCalendar($calid, $st, $et, $sub, $ade, $dscr, $loc, $color, $rrule,$uid,$tz){eval(base64_decode('JHJldCA9IGFycmF5KCk7ICRkYiA9JiBKRmFjdG9yeTo6Z2V0REJPKCk7ICR1c2VyID0mIEpGYWN0b3J5OjpnZXRVc2VyKCk7IHRyeXsgJGEgPSBhcnJheSgic3QiPT4kc3QsImV0Ij0+JGV0LCJ0aXRsZSI9PiRzdWIsImFsbCI9PiRhZGUsImxvYyI9PiRsb2MsImNvbG9yIj0+JGNvbG9yLCJkZXNjIj0+JGRzY3IsInJydWxlIj0+JHJydWxlLCJ1aWQiPT4kdWlkLCJvd25lciI9PiR1c2VyLT5pZCwicHVibGlzaGVkIj0+MSk7ICRkYXRhID0gc2VyaWFsaXplICgkYSk7ICRzcWwgPSAic2VsZWN0ICogZnJvbSBgI19fZGNfbXZfZnJlZWAiOyAkZGItPnNldFF1ZXJ5KCAkc3FsICk7ICRyb3dzID0gJGRiLT5sb2FkT2JqZWN0TGlzdCgpOyAkc3FsID0gIiI7IGlmICgkcm93c1swXS0+YT09IiIpIHsgJHNxbCA9ICJhIjsgJGlkID0gMTsgfSBlbHNlIGlmICgkcm93c1swXS0+Yj09IiIpIHsgJHNxbCA9ICJiIjsgJGlkID0gMjsgfSBlbHNlIGlmICgkcm93c1swXS0+Yz09IiIpIHsgJHNxbCA9ICJjIjsgJGlkID0gMzsgfSBlbHNlIGlmICgkcm93c1swXS0+ZD09IiIpIHsgJHNxbCA9ICJkIjsgJGlkID0gNDsgfSBlbHNlIGlmICgkcm93c1swXS0+ZT09IiIpIHsgJHNxbCA9ICJlIjsgJGlkID0gNTsgfSBpZiAoJHNxbCE9IiIpIHsgJHNxbCA9ICJ1cGRhdGUgYCNfX2RjX212X2ZyZWVgIHNldCAiLiRzcWwuIj0iLiRkYi0+UXVvdGUoJGRhdGEpLiIgd2hlcmUgaWQ9MSI7ICRkYi0+c2V0UXVlcnkoICRzcWwgKTsgaWYgKCEkZGItPnF1ZXJ5KCkpeyAkcmV0WyJJc1N1Y2Nlc3MiXSA9IGZhbHNlOyAkcmV0WyJNc2ciXSA9IG15c3FsX2Vycm9yKCk7IH1lbHNleyAkcmV0WyJJc1N1Y2Nlc3MiXSA9IHRydWU7ICRyZXRbIk1zZyJdID0gImFkZCBzdWNjZXNzIjsgJHJldFsiRGF0YSJdID0gJGlkOyB9IH0gZWxzZSB7ICRyZXRbIklzU3VjY2VzcyJdID0gZmFsc2U7ICRyZXRbIk1zZyJdID0gIlRoaXMgZnJlZSB2ZXJzaW9uIHN1cHBvcnRzIHVwIHRvIDUgZXZlbnRzLlxuXG5UaGUgZXZlbnQgd2lsbCBiZSBzaG93biBub3cgaW4gdGhlIGNhbGVuZGFyIGJ1dCB3b24ndCBiZSBzYXZlZCB3aGVuIHlvdSByZWZyZXNoIHRoZSBwYWdlLlxuXG5QbGVhc2UgdXBncmFkZSB0byBnZXQgYWNjZXNzIHRvIGEgdmVyc2lvbiB0aGF0IGFsbG93cyB1bmxpbWl0ZWQgZXZlbnRzOlxuXG53d3cuSm9vbWxhQ2FsZW5kYXJzLmNvbSI7IH0gfWNhdGNoKEV4Y2VwdGlvbiAkZSl7ICRyZXRbIklzU3VjY2VzcyJdID0gZmFsc2U7ICRyZXRbIk1zZyJdID0gJGUtPmdldE1lc3NhZ2UoKTsgfQ=='));return $ret;}
                                                                                                                     
function listCalendarByRange($calid,$sd, $ed){eval(base64_decode('JHJldCA9IGFycmF5KCk7ICRyZXRbImV2ZW50cyJdID0gYXJyYXkoKTsgJHJldFsiaXNzb3J0Il0gPXRydWU7ICRyZXRbInN0YXJ0Il0gPSBwaHAySnNUaW1lKCRzZCk7ICRyZXRbImVuZCJdID0gcGhwMkpzVGltZSgkZWQpOyAkcmV0WyJlcnJvciJdID0gbnVsbDsgJGRiID0mIEpGYWN0b3J5OjpnZXREQk8oKTsgdHJ5eyAkc3FsID0gInNlbGVjdCAqIGZyb20gYCNfX2RjX212X2ZyZWVgIHdoZXJlIGlkPTEgIjsgJGRiLT5zZXRRdWVyeSggJHNxbCApOyAkcm93cyA9ICRkYi0+bG9hZE9iamVjdExpc3QoKTsgaWYgKCRyb3dzWzBdLT5hIT0iIikgeyAkZGF0YSA9IHVuc2VyaWFsaXplICgkcm93c1swXS0+YSk7IGlmIChzdHJsZW4oJGRhdGFbImV4ZGF0ZSJdKT4wKSAkZGF0YVsicnJ1bGUiXSAuPSAiO2V4ZGF0ZT0iLiRkYXRhWyJleGRhdGUiXTsgJHJldFsiZXZlbnRzIl1bXSA9IGFycmF5KDEsJGRhdGFbdGl0bGVdLCRkYXRhWyJzdCJdLCRkYXRhWyJldCJdLCRkYXRhWyJhbGwiXSwwLCAoKGlzX251bWVyaWMoJGRhdGFbInVpZCJdKSAmJiAkZGF0YVsidWlkIl0+MCk/JGRhdGFbInVpZCJdOiRkYXRhWyJycnVsZSJdKSwkZGF0YVsiY29sb3IiXSwxLCRkYXRhWyJsb2MiXSwgIiIsJGRhdGFbImRlc2MiXSwkZGF0YVsib3duZXIiXSwkZGF0YVsicHVibGlzaGVkIl0pOyB9IGlmICgkcm93c1swXS0+YiE9IiIpIHsgJGRhdGEgPSB1bnNlcmlhbGl6ZSAoJHJvd3NbMF0tPmIpOyBpZiAoc3RybGVuKCRkYXRhWyJleGRhdGUiXSk+MCkgJGRhdGFbInJydWxlIl0gLj0gIjtleGRhdGU9Ii4kZGF0YVsiZXhkYXRlIl07ICRyZXRbImV2ZW50cyJdW10gPSBhcnJheSgyLCRkYXRhW3RpdGxlXSwkZGF0YVsic3QiXSwkZGF0YVsiZXQiXSwkZGF0YVsiYWxsIl0sMCwgKChpc19udW1lcmljKCRkYXRhWyJ1aWQiXSkgJiYgJGRhdGFbInVpZCJdPjApPyRkYXRhWyJ1aWQiXTokZGF0YVsicnJ1bGUiXSksJGRhdGFbImNvbG9yIl0sMSwkZGF0YVsibG9jIl0sICIiLCRkYXRhWyJkZXNjIl0sJGRhdGFbIm93bmVyIl0sJGRhdGFbInB1Ymxpc2hlZCJdKTsgfSBpZiAoJHJvd3NbMF0tPmMhPSIiKSB7ICRkYXRhID0gdW5zZXJpYWxpemUgKCRyb3dzWzBdLT5jKTsgaWYgKHN0cmxlbigkZGF0YVsiZXhkYXRlIl0pPjApICRkYXRhWyJycnVsZSJdIC49ICI7ZXhkYXRlPSIuJGRhdGFbImV4ZGF0ZSJdOyAkcmV0WyJldmVudHMiXVtdID0gYXJyYXkoMywkZGF0YVt0aXRsZV0sJGRhdGFbInN0Il0sJGRhdGFbImV0Il0sJGRhdGFbImFsbCJdLDAsICgoaXNfbnVtZXJpYygkZGF0YVsidWlkIl0pICYmICRkYXRhWyJ1aWQiXT4wKT8kZGF0YVsidWlkIl06JGRhdGFbInJydWxlIl0pLCRkYXRhWyJjb2xvciJdLDEsJGRhdGFbImxvYyJdLCAiIiwkZGF0YVsiZGVzYyJdLCRkYXRhWyJvd25lciJdLCRkYXRhWyJwdWJsaXNoZWQiXSk7IH0gaWYgKCRyb3dzWzBdLT5kIT0iIikgeyAkZGF0YSA9IHVuc2VyaWFsaXplICgkcm93c1swXS0+ZCk7IGlmIChzdHJsZW4oJGRhdGFbImV4ZGF0ZSJdKT4wKSAkZGF0YVsicnJ1bGUiXSAuPSAiO2V4ZGF0ZT0iLiRkYXRhWyJleGRhdGUiXTsgJHJldFsiZXZlbnRzIl1bXSA9IGFycmF5KDQsJGRhdGFbdGl0bGVdLCRkYXRhWyJzdCJdLCRkYXRhWyJldCJdLCRkYXRhWyJhbGwiXSwwLCAoKGlzX251bWVyaWMoJGRhdGFbInVpZCJdKSAmJiAkZGF0YVsidWlkIl0+MCk/JGRhdGFbInVpZCJdOiRkYXRhWyJycnVsZSJdKSwkZGF0YVsiY29sb3IiXSwxLCRkYXRhWyJsb2MiXSwgIiIsJGRhdGFbImRlc2MiXSwkZGF0YVsib3duZXIiXSwkZGF0YVsicHVibGlzaGVkIl0pOyB9IGlmICgkcm93c1swXS0+ZSE9IiIpIHsgJGRhdGEgPSB1bnNlcmlhbGl6ZSAoJHJvd3NbMF0tPmUpOyBpZiAoc3RybGVuKCRkYXRhWyJleGRhdGUiXSk+MCkgJGRhdGFbInJydWxlIl0gLj0gIjtleGRhdGU9Ii4kZGF0YVsiZXhkYXRlIl07ICRyZXRbImV2ZW50cyJdW10gPSBhcnJheSg1LCRkYXRhW3RpdGxlXSwkZGF0YVsic3QiXSwkZGF0YVsiZXQiXSwkZGF0YVsiYWxsIl0sMCwgKChpc19udW1lcmljKCRkYXRhWyJ1aWQiXSkgJiYgJGRhdGFbInVpZCJdPjApPyRkYXRhWyJ1aWQiXTokZGF0YVsicnJ1bGUiXSksJGRhdGFbImNvbG9yIl0sMSwkZGF0YVsibG9jIl0sICIiLCRkYXRhWyJkZXNjIl0sJGRhdGFbIm93bmVyIl0sJGRhdGFbInB1Ymxpc2hlZCJdKTsgfSAkcmV0WyJldmVudHMiXT1hcnJheV9yZXZlcnNlKCRyZXRbImV2ZW50cyJdKTsgfWNhdGNoKEV4Y2VwdGlvbiAkZSl7ICRyZXRbImVycm9yIl0gPSAkZS0+Z2V0TWVzc2FnZSgpOyB9'));return $ret;}
function updateCalendar($id, $st, $et){eval(base64_decode('JHJldCA9IGFycmF5KCk7ICRkYiA9JiBKRmFjdG9yeTo6Z2V0REJPKCk7IHRyeXsgJHNxbCA9ICJzZWxlY3QgKiBmcm9tIGAjX19kY19tdl9mcmVlYCB3aGVyZSBpZD0xIjsgJGRiLT5zZXRRdWVyeSggJHNxbCApOyAkcm93cyA9ICRkYi0+bG9hZE9iamVjdExpc3QoKTsgc3dpdGNoICgkaWQpIHsgY2FzZSAxOiAkc3FsID0gImEiOyAkZGF0YSA9ICRyb3dzWzBdLT5hOyBicmVhazsgY2FzZSAyOiAkc3FsID0gImIiOyAkZGF0YSA9ICRyb3dzWzBdLT5iOyBicmVhazsgY2FzZSAzOiAkc3FsID0gImMiOyAkZGF0YSA9ICRyb3dzWzBdLT5jOyBicmVhazsgY2FzZSA0OiAkc3FsID0gImQiOyAkZGF0YSA9ICRyb3dzWzBdLT5kOyBicmVhazsgY2FzZSA1OiAkc3FsID0gImUiOyAkZGF0YSA9ICRyb3dzWzBdLT5lOyBicmVhazsgfSAkZGF0YSA9IHVuc2VyaWFsaXplICgkZGF0YSk7ICRkYXRhWyJzdCJdID0gJHN0OyAkZGF0YVsiZXQiXSA9ICRldDsgJGRhdGEgPSBzZXJpYWxpemUgKCRkYXRhKTsgJHNxbCA9ICJ1cGRhdGUgYCNfX2RjX212X2ZyZWVgIHNldCAiLiRzcWwuIj0iLiRkYi0+UXVvdGUoJGRhdGEpLiIgd2hlcmUgaWQ9MSI7ICRkYi0+c2V0UXVlcnkoICRzcWwgKTsgaWYgKCEkZGItPnF1ZXJ5KCkpeyAkcmV0WyJJc1N1Y2Nlc3MiXSA9IGZhbHNlOyAkcmV0WyJNc2ciXSA9IG15c3FsX2Vycm9yKCk7IH1lbHNleyAkcmV0WyJJc1N1Y2Nlc3MiXSA9IHRydWU7ICRyZXRbIk1zZyJdID0gIlN1Y2NlZnVsbHkiOyB9IH1jYXRjaChFeGNlcHRpb24gJGUpeyAkcmV0WyJJc1N1Y2Nlc3MiXSA9IGZhbHNlOyAkcmV0WyJNc2ciXSA9ICRlLT5nZXRNZXNzYWdlKCk7IH0='));return $ret;}
function updateDetailedCalendar($id, $st, $et, $sub, $ade, $dscr, $loc, $color, $rrule,$rruleType,$tz){eval(base64_decode('JHJldCA9IGFycmF5KCk7ICRkYiA9JiBKRmFjdG9yeTo6Z2V0REJPKCk7IHRyeXsgJHNxbCA9ICJzZWxlY3QgKiBmcm9tIGAjX19kY19tdl9mcmVlYCB3aGVyZSBpZD0xIjsgJGRiLT5zZXRRdWVyeSggJHNxbCApOyAkcm93cyA9ICRkYi0+bG9hZE9iamVjdExpc3QoKTsgc3dpdGNoICgkaWQpIHsgY2FzZSAxOiAkc3FsID0gImEiOyAkZGF0YSA9ICRyb3dzWzBdLT5hOyBicmVhazsgY2FzZSAyOiAkc3FsID0gImIiOyAkZGF0YSA9ICRyb3dzWzBdLT5iOyBicmVhazsgY2FzZSAzOiAkc3FsID0gImMiOyAkZGF0YSA9ICRyb3dzWzBdLT5jOyBicmVhazsgY2FzZSA0OiAkc3FsID0gImQiOyAkZGF0YSA9ICRyb3dzWzBdLT5kOyBicmVhazsgY2FzZSA1OiAkc3FsID0gImUiOyAkZGF0YSA9ICRyb3dzWzBdLT5lOyBicmVhazsgfSAkZGF0YSA9IHVuc2VyaWFsaXplICgkZGF0YSk7IGlmICgkcnJ1bGVUeXBlPT0ib25seSIpeyRyZXQgPSBhZGREZXRhaWxlZENhbGVuZGFyKEpSZXF1ZXN0OjpnZXRWYXIoICJjYWxpZCIgKSwgJHN0LCAkZXQsICRzdWIsICRhZGUsICRkc2NyLCAkbG9jLCAkY29sb3IsICIiLCRpZCwkdHopO30gZWxzZSBpZiAoJHJydWxlVHlwZT09ImFsbCIpeyRkYXRhWyJycnVsZSJdID0gJHJydWxlOyAkZGF0YVsidGl0bGUiXSA9ICRzdWI7ICRkYXRhWyJhbGwiXSA9ICRhZGU7ICRkYXRhWyJsb2MiXSA9ICRsb2M7ICRkYXRhWyJjb2xvciJdID0gJGNvbG9yOyAkZGF0YVsiZGVzYyJdID0gJGRzY3I7ICRkYXRhID0gc2VyaWFsaXplICgkZGF0YSk7ICRzcWwgPSAidXBkYXRlIGAjX19kY19tdl9mcmVlYCBzZXQgIi4kc3FsLiI9Ii4kZGItPlF1b3RlKCRkYXRhKS4iIHdoZXJlIGlkPTEiOyAkZGItPnNldFF1ZXJ5KCAkc3FsICk7IGlmICghJGRiLT5xdWVyeSgpKXsgJHJldFsiSXNTdWNjZXNzIl0gPSBmYWxzZTsgJHJldFsiTXNnIl0gPSBteXNxbF9lcnJvcigpOyB9ZWxzZXsgJHJldFsiSXNTdWNjZXNzIl0gPSB0cnVlOyAkcmV0WyJNc2ciXSA9ICJTdWNjZWZ1bGx5IjsgfX1lbHNlIGlmIChzdWJzdHIoJHJydWxlVHlwZSwwLDUpPT0iVU5USUwiKXskcHJlX3JydWxlID0gJGRhdGFbInJydWxlIl07JHRtcCA9IGV4cGxvZGUoIjtVTlRJTD0iLCRwcmVfcnJ1bGUpO2lmIChjb3VudCgkdG1wKT4xKXskcHJlX3JydWxlID0gJHRtcFswXTskdG1wMiA9IGV4cGxvZGUoIjsiLCR0bXBbMV0pO2lmIChjb3VudCgkdG1wMik+MSkkcHJlX3JydWxlIC49ICI7Ii4kdG1wMlsxXTt9JHByZV9ycnVsZSAuPSAiOyIuJHJydWxlVHlwZTskZGF0YVsicnJ1bGUiXSA9ICRwcmVfcnJ1bGU7JGRhdGEgPSBzZXJpYWxpemUgKCRkYXRhKTskc3FsID0gInVwZGF0ZSBgI19fZGNfbXZfZnJlZWAgc2V0ICIuJHNxbC4iPSIuJGRiLT5RdW90ZSgkZGF0YSkuIiB3aGVyZSBpZD0xIjsgJGRiLT5zZXRRdWVyeSggJHNxbCApOyRkYi0+cXVlcnkoKTskcmV0PWFkZERldGFpbGVkQ2FsZW5kYXIoSlJlcXVlc3Q6OmdldFZhciggImNhbGlkIiApLCAkc3QsICRldCwgJHN1YiwgJGFkZSwgJGRzY3IsICRsb2MsICRjb2xvciwgJHJydWxlLDAsJHR6KTt9ZWxzZXskZGF0YVsicnJ1bGUiXSA9ICRycnVsZTsgJGRhdGFbInN0Il0gPSAkc3Q7ICRkYXRhWyJldCJdID0gJGV0OyAkZGF0YVsidGl0bGUiXSA9ICRzdWI7ICRkYXRhWyJhbGwiXSA9ICRhZGU7ICRkYXRhWyJsb2MiXSA9ICRsb2M7ICRkYXRhWyJjb2xvciJdID0gJGNvbG9yOyAkZGF0YVsiZGVzYyJdID0gJGRzY3I7ICRkYXRhID0gc2VyaWFsaXplICgkZGF0YSk7ICRzcWwgPSAidXBkYXRlIGAjX19kY19tdl9mcmVlYCBzZXQgIi4kc3FsLiI9Ii4kZGItPlF1b3RlKCRkYXRhKS4iIHdoZXJlIGlkPTEiOyAkZGItPnNldFF1ZXJ5KCAkc3FsICk7IGlmICghJGRiLT5xdWVyeSgpKXsgJHJldFsiSXNTdWNjZXNzIl0gPSBmYWxzZTsgJHJldFsiTXNnIl0gPSBteXNxbF9lcnJvcigpOyB9ZWxzZXsgJHJldFsiSXNTdWNjZXNzIl0gPSB0cnVlOyAkcmV0WyJNc2ciXSA9ICJTdWNjZWZ1bGx5IjsgfX19Y2F0Y2goRXhjZXB0aW9uICRlKXsgJHJldFsiSXNTdWNjZXNzIl0gPSBmYWxzZTsgJHJldFsiTXNnIl0gPSAkZS0+Z2V0TWVzc2FnZSgpOyB9'));return $ret;}
function removeCalendar($id,$rruleType){eval(base64_decode('JHJldCA9IGFycmF5KCk7ICRkYiA9JiBKRmFjdG9yeTo6Z2V0REJPKCk7IHRyeXsgJHNxbCA9ICJzZWxlY3QgKiBmcm9tIGAjX19kY19tdl9mcmVlYCB3aGVyZSBpZD0xIjsgJGRiLT5zZXRRdWVyeSggJHNxbCApOyAkcm93cyA9ICRkYi0+bG9hZE9iamVjdExpc3QoKTtzd2l0Y2ggKCRpZCkgeyBjYXNlIDE6ICRzcWwgPSAiYSI7JGRhdGEgPSB1bnNlcmlhbGl6ZSAoJHJvd3NbMF0tPmEpOyBicmVhazsgY2FzZSAyOiAkc3FsID0gImIiOyRkYXRhID0gdW5zZXJpYWxpemUgKCRyb3dzWzBdLT5iKTsgYnJlYWs7IGNhc2UgMzogJHNxbCA9ICJjIjskZGF0YSA9IHVuc2VyaWFsaXplICgkcm93c1swXS0+Yyk7IGJyZWFrOyBjYXNlIDQ6ICRzcWwgPSAiZCI7JGRhdGEgPSB1bnNlcmlhbGl6ZSAoJHJvd3NbMF0tPmQpOyBicmVhazsgY2FzZSA1OiAkc3FsID0gImUiOyRkYXRhID0gdW5zZXJpYWxpemUgKCRyb3dzWzBdLT5lKTsgYnJlYWs7IH0gaWYgKHN1YnN0cigkcnJ1bGVUeXBlLDAsOCk9PSJkZWxfb25seSIpeyRkYXRhWyJleGRhdGUiXSA9ICRkYXRhWyJleGRhdGUiXS5zdWJzdHIoJHJydWxlVHlwZSw4KTskc3FsID0gInVwZGF0ZSBgI19fZGNfbXZfZnJlZWAgc2V0ICIuJHNxbC4iPSIuJGRiLT5RdW90ZShzZXJpYWxpemUgKCRkYXRhKSkuIiB3aGVyZSBpZD0xIjt9ZWxzZSBpZiAoc3Vic3RyKCRycnVsZVR5cGUsMCw5KT09ImRlbF9VTlRJTCIpeyRwcmVfcnJ1bGUgPSAkZGF0YVsicnJ1bGUiXTskdG1wID0gZXhwbG9kZSgiO1VOVElMPSIsJHByZV9ycnVsZSk7aWYgKGNvdW50KCR0bXApPjEpeyRwcmVfcnJ1bGUgPSAkdG1wWzBdOyR0bXAyID0gZXhwbG9kZSgiOyIsJHRtcFsxXSk7aWYgKGNvdW50KCR0bXAyKT4xKSRwcmVfcnJ1bGUgLj0gIjsiLiR0bXAyWzFdO30kcHJlX3JydWxlIC49ICI7Ii5zdWJzdHIoJHJydWxlVHlwZSw0KTskZGF0YVsicnJ1bGUiXSA9ICRwcmVfcnJ1bGU7JHNxbCA9ICJ1cGRhdGUgYCNfX2RjX212X2ZyZWVgIHNldCAiLiRzcWwuIj0iLiRkYi0+UXVvdGUoc2VyaWFsaXplICgkZGF0YSkpLiIgd2hlcmUgaWQ9MSI7fWVsc2V7JHNxbCA9ICJ1cGRhdGUgYCNfX2RjX212X2ZyZWVgIHNldCAiLiRzcWwuIj0nJyB3aGVyZSBpZD0xIjt9JGRiLT5zZXRRdWVyeSggJHNxbCApOyBpZiAoISRkYi0+cXVlcnkoKSl7ICRyZXRbIklzU3VjY2VzcyJdID0gZmFsc2U7ICRyZXRbIk1zZyJdID0gbXlzcWxfZXJyb3IoKTsgfWVsc2V7ICRyZXRbIklzU3VjY2VzcyJdID0gdHJ1ZTsgJHJldFsiTXNnIl0gPSAiU3VjY2VmdWxseSI7IH0gfWNhdGNoKEV4Y2VwdGlvbiAkZSl7ICRyZXRbIklzU3VjY2VzcyJdID0gZmFsc2U7ICRyZXRbIk1zZyJdID0gJGUtPmdldE1lc3NhZ2UoKTsgfQ=='));return $ret;}
jexit();
?>